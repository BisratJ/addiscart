"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[643],{4190:function(e,t,r){r.d(t,{H:function(){return p},a:function(){return d}});var o=r(7437),a=r(2265),n=r(605);let s=r(3464).Z.create({baseURL:"http://localhost:5001/api",headers:{"Content-Type":"application/json"},timeout:1e4});s.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;return((null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),window.location.href="/auth/login"),(!e.response||e.response.status>=500&&e.response.status<600)&&r&&!r._retry&&(r._retryCount=r._retryCount||0,r._retryCount<2))?(r._retryCount+=1,r._retry=!0,await new Promise(e=>setTimeout(e,1e3*Math.pow(2,r._retryCount))),s(r)):Promise.reject(e)});let l=[{id:"1",name:"Admin User",email:"admin@example.com",phone:"555-123-4567",role:"admin"},{id:"2",name:"Test User",email:"user@example.com",phone:"555-987-6543",role:"customer"},{id:"3",name:"Shopper User",email:"shopper@example.com",phone:"555-456-7890",role:"shopper"}],i=()=>"mock-token-".concat(Math.random().toString(36).substring(2,15)),u=(e,t)=>new Promise((t,r)=>{let o=l.find(t=>t.email===e);o?t({token:i(),user:o}):r(Error("Invalid credentials"))}),c=e=>new Promise((t,r)=>{if(l.find(t=>t.email===e.email)){r(Error("User already exists"));return}let o={id:"".concat(l.length+1),name:e.name,email:e.email,phone:e.phone,role:"customer"};l.push(o),t({token:i(),user:o})}),m=()=>new Promise(e=>{if(!localStorage.getItem("token")){e(null);return}e(l[1])}),h=(0,a.createContext)(void 0),p=e=>{let{children:t}=e,{data:r,status:s}=(0,n.useSession)(),[l,i]=(0,a.useState)(null),[p,d]=(0,a.useState)(null),[g,f]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=async()=>{let e=localStorage.getItem("userData"),t=localStorage.getItem("token");if(t&&e)try{let r=JSON.parse(e),o=r.timestamp||0;if(Date.now()-o<6048e5){d(t),i(r.user),f(!1);return}}catch(e){console.error("Error parsing cached user data:",e)}if(t){d(t);try{let e;(e=await m())&&(localStorage.setItem("userData",JSON.stringify({user:e,timestamp:Date.now()})),i(e))}catch(e){console.error("Authentication error:",e),localStorage.removeItem("token"),localStorage.removeItem("userData"),d(null)}}f(!1)};if("loading"===s){f(!0);return}if(null==r?void 0:r.user){i({id:r.user.id||r.user.email||"",name:r.user.name||"",email:r.user.email||"",role:"customer"}),d(r.accessToken||"google-oauth-token"),f(!1);return}e()},[r,s]);let S=(0,a.useCallback)(async(e,t)=>{f(!0);try{{let{token:r,user:o}=await u(e,t);localStorage.setItem("token",r),localStorage.setItem("userData",JSON.stringify({user:o,timestamp:Date.now()})),d(r),i(o)}}catch(e){throw console.error("Login error:",e),e}finally{f(!1)}},[]),y=(0,a.useCallback)(async e=>{f(!0);try{{let{token:t,user:r}=await c(e);localStorage.setItem("token",t),localStorage.setItem("userData",JSON.stringify({user:r,timestamp:Date.now()})),d(t),i(r)}}catch(e){throw console.error("Registration error:",e),e}finally{f(!1)}},[]),w=(0,a.useCallback)(async e=>{f(!0);try{let t={...l,...e};i(t),localStorage.setItem("userData",JSON.stringify({user:t,timestamp:Date.now()}))}catch(e){throw console.error("Profile update error:",e),e}finally{f(!1)}},[l,p]),_=(0,a.useCallback)(async()=>{r&&await (0,n.signOut)({redirect:!1}),localStorage.removeItem("token"),localStorage.removeItem("userData"),localStorage.removeItem("cart"),d(null),i(null),window.location.href="/"},[r]),v=(0,a.useMemo)(()=>({user:l,token:p,isLoading:g,isAuthenticated:!!l,login:S,register:y,logout:_,updateProfile:w}),[l,p,g,S,y,_,w]);return(0,o.jsx)(h.Provider,{value:v,children:t})},d=()=>{let e=(0,a.useContext)(h);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4127:function(e,t,r){r.d(t,{cn:function(){return s}});var o=r(1994),a=r(3335),n=r(257);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,o.W)(t))}n.env.NEXT_PUBLIC_ENABLE_GOOGLE_AUTH,n.env.NEXT_PUBLIC_ENABLE_STRIPE,n.env.NEXT_PUBLIC_ENABLE_ANALYTICS,n.env.NEXT_PUBLIC_ENABLE_PWA}}]);